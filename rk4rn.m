% Example:
% [yn, y, t, h] = rk4rn(@(x,y) [y(2); exp(x)-2*y(2)-y(1)], [1 -1], 0, 0.2, 2)
% returns
% yn = 8.375258327995083e-01    -6.361897403550422e-01
% y = 1.000000000000000e+00    -1.000000000000000e+00
%     9.096790251385241e-01    -8.095122344754171e-01
%     8.375258327995083e-01    -6.361897403550422e-01
% t = 0  1.000000000000000e-01  2.000000000000000e-01
% h = 1.000000000000000e-01
function [yn, y, x, h] = rk4rn(f, y0, x0, xn, n)
   h = (xn - x0) / n;
   y0 = y0(:)'; % ensure/convert y0 is a horizontal vector
   y(1,:) = y0;
   x = x0:h:xn;
   for i = 1:length(x)-1
       k1 = f(x(i), y(i,:))';
       k2 = f(x(i) + 0.5 * h, y(i,:) + 0.5 * h * k1)';
       k3 = f(x(i) + 0.5 * h, y(i,:) + 0.5 * h * k2)';
       k4 = f(x(i) + h, y(i,:) + k3 * h)';
       y(i+1,:) = y(i,:) + (k1 + 2*k2 + 2*k3 + k4) * h / 6;   
   end
   yn = y(end,:);
